{
  "hash": "acc1ec79632aa585ca7dce2a0e88952a",
  "result": {
    "markdown": "---\ntitle: \"Predicting \"\nauthor: \"Scott Flaska\"\ndate: \"2023-04-10\"\ndraft: true\ncategories: [shotlink, golf, r]\nimage: \"\"\nformat: html\n---\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(tidymodels)\n```\n:::\n\n\nFirst, I'll load the cleaned up shot-level data from my [previous post](https://scottflaska.github.io/blog/posts/02_shotlink_explore/).\n\n\n::: {.cell}\n\n```{.r .cell-code}\nshot_level <- readRDS(\"../02_shotlink_explore/shot_level.rds\")\ncut_colors <- readRDS(\"../02_shotlink_explore/cut_colors.rds\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nshot_level %>% \n  ggplot(mapping = aes(x = yards_out_before_shot,\n                       y = strokes_remaining_before_shot)) +\n  geom_jitter(width = 0,\n              height = 0.1,\n              alpha = 0.1) +\n  geom_smooth(method = loess,\n              se = FALSE) +\n  scale_y_continuous(breaks = 1:10) +\n  theme_minimal()\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n`geom_smooth()` using formula = 'y ~ x'\n```\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n\n```{.r .cell-code}\nshot_level %>% \n  mutate(log_yards_out_before_shot = log(yards_out_before_shot+1)) %>% \n  ggplot(mapping = aes(x = log_yards_out_before_shot,\n                       y = strokes_remaining_before_shot)) +\n  geom_jitter(width = 0,\n              height = 0.1,\n              alpha = 0.1) +\n  geom_smooth(method = loess,\n              se = FALSE) +\n  scale_y_continuous(breaks = 1:10) +\n  theme_minimal()\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n`geom_smooth()` using formula = 'y ~ x'\n```\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-3-2.png){width=672}\n:::\n\n```{.r .cell-code}\nshot_model_data <- shot_level %>% \n  mutate(log_yards_out_before_shot = log(yards_out_before_shot+1))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nfolds <- group_vfold_cv(data = shot_model_data,\n                        group = round)\n\njust_log_yards_recipe <- recipe(formula = strokes_remaining_before_shot ~ \n                              log_yards_out_before_shot, \n                      data = shot_model_data)\n\nlm_mod <- linear_reg(mode = \"regression\", \n                     engine = \"lm\")\n\nlm_workflow <- workflow() %>%\n  add_recipe(just_log_yards_recipe) %>% \n  add_model(lm_mod) \n\nlm_rs <- fit_resamples(object = lm_workflow,\n                       resamples = folds)\n\nlm_rs %>% \n  collect_metrics() %>% \n  select(.metric,\n         mean) %>% \n  as.data.frame()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  .metric      mean\n1    rmse 0.5734776\n2     rsq 0.7789109\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\njust_yards_recipe <- recipe(formula = strokes_remaining_before_shot ~ \n                              yards_out_before_shot, \n                            data = shot_model_data)\n\nxgb_mod <- boost_tree(mode = \"regression\", \n                      engine = \"xgboost\")\n\nxgb_workflow <- workflow() %>%\n  add_recipe(just_yards_recipe) %>% \n  add_model(xgb_mod) \n\nxgb_rs <- fit_resamples(object = xgb_workflow,\n                        resamples = folds)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: package 'xgboost' was built under R version 4.2.2\n```\n:::\n\n```{.r .cell-code}\nxgb_rs %>% \n  collect_metrics() %>% \n  select(.metric,\n         mean) %>% \n  as.data.frame()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  .metric      mean\n1    rmse 0.5455876\n2     rsq 0.8003051\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nshot_model_data %>% \n  filter(player == 1810,\n         round == 1,\n         hole == 1) %>% \n  select(shot,\n         strokes_remaining_before_shot,\n         yards_out_before_shot,\n         x,\n         y)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  shot strokes_remaining_before_shot yards_out_before_shot       x       y\n1    1                             4            429.000000 9093.97 9859.90\n2    2                             3            133.000000 8683.75 9868.71\n3    3                             2              7.805556 8697.45 9845.29\n4    4                             1              1.083333      NA      NA\n```\n:::\n\n```{.r .cell-code}\nshot_model_data <- shot_model_data %>% \n  group_by(player,\n           round,\n           hole) %>% \n  mutate(x_before_shot = lag(x, \n                             n = 1,\n                             order_by = shot),\n         y_before_shot = lag(y,\n                             n = 1,\n                             order_by = shot)) %>% \n  ungroup()\n\nfolds <- group_vfold_cv(data = shot_model_data,\n                        group = round)\n\nwith_coords_recipe <- recipe(formula = strokes_remaining_before_shot ~ \n                               yards_out_before_shot +\n                               x_before_shot +\n                               y_before_shot +\n                               hole, \n                             data = shot_model_data)\n\nxgb_workflow <- workflow() %>%\n  add_recipe(with_coords_recipe) %>% \n  add_model(xgb_mod) \n\nxgb_rs <- fit_resamples(object = xgb_workflow,\n                        resamples = folds)\n\nxgb_rs %>% \n  collect_metrics() %>% \n  select(.metric,\n         mean) %>% \n  as.data.frame()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  .metric      mean\n1    rmse 0.5445473\n2     rsq 0.8009740\n```\n:::\n:::\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}