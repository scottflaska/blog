{
  "hash": "9bcb648066f3902540d641c8b8f6c3ce",
  "result": {
    "markdown": "---\ntitle: \"Building a Strokes Gained Model for Golf\"\nauthor: \"Scott Flaska\"\ndate: \"2023-05-01\"\ndraft: true\ncategories: [shotlink, golf, r, machine learning]\nimage: \"\"\nformat: html\n---\n\n\nStrokes Gained is an interesting method for evaluating golfers, co-created by Columbia Business School professor Mark Broadie.\n\n\n```{=html}\n<blockquote class=\"twitter-tweet\" data-lang=\"en\" data-theme=\"dark\"><p lang=\"en\" dir=\"ltr\">Strokes Gained co-creator <a href=\"https://twitter.com/MarkBroadie?ref_src=twsrc%5Etfw\">@markbroadie</a> illustrates the statistic using Justin Thomas&#39; final-round eagle at the 2021 <a href=\"https://twitter.com/hashtag/THEPLAYERS?src=hash&amp;ref_src=twsrc%5Etfw\">#THEPLAYERS</a>. ðŸ”Ž <a href=\"https://t.co/LJ6qnp3ooE\">pic.twitter.com/LJ6qnp3ooE</a></p>&mdash; Golf Channel (@GolfChannel) <a href=\"https://twitter.com/GolfChannel/status/1633598893706338305?ref_src=twsrc%5Etfw\">March 8, 2023</a></blockquote> <script async src=\"https://platform.twitter.com/widgets.js\" charset=\"utf-8\"></script>\n```\n\nStrokes Gained is similar to Expected Points Added (EPA) in football - golfers are evaluated against an \"expected\" number of strokes remaining after each shot. This \"expected\" value is based off a predictive model trained on historical data[^1]. In this post, I'll build my own Strokes Gained model using PGA ShotLink data.\n\n[^1]: These methods have a major shortcoming in that they attribute the entire residual to a single golfer (or the teams involved). This could probably be corrected with a hierarchical/mixed model, but I'll save that for a future post.\n\nFirst, I'll load the cleaned up shot-level data from my [previous post](https://scottflaska.github.io/blog/posts/02_shotlink_explore/).\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(tidymodels)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nshot_level <- readRDS(\"../02_shotlink_explore/shot_level.rds\")\ncut_colors <- readRDS(\"../02_shotlink_explore/cut_colors.rds\")\n```\n:::\n\n\nIntuitively, distance from the hole will probably be the best predictor of strokes remaining.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nshot_level %>% \n  ggplot(mapping = aes(x = yards_out_before_shot,\n                       y = strokes_remaining_before_shot)) +\n  geom_jitter(width = 0,\n              height = 0.1,\n              alpha = 0.1) +\n  geom_smooth(method = loess,\n              se = FALSE) +\n  scale_y_continuous(breaks = 1:10) +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n\n```{.r .cell-code}\n#Calculate R-Squared\ncor(shot_level$yards_out_before_shot, \n    shot_level$strokes_remaining_before_shot)^2\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0.6659518\n```\n:::\n:::\n\n\nWhile there is a certainly a correlation between these numbers, the relationship is not quite linear. A log transformation should clean this up.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nshot_level <- shot_level %>% \n  mutate(log_yards_out_before_shot = log(yards_out_before_shot+1))\n  \n\nshot_level %>% \n  ggplot(mapping = aes(x = log_yards_out_before_shot,\n                       y = strokes_remaining_before_shot)) +\n  geom_jitter(width = 0,\n              height = 0.1,\n              alpha = 0.1) +\n  geom_smooth(method = loess,\n              se = FALSE) +\n  scale_y_continuous(breaks = 1:10) +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n\n```{.r .cell-code}\n#Calculate R-Squared\ncor(shot_level$log_yards_out_before_shot, \n    shot_level$strokes_remaining_before_shot)^2\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0.7783551\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# shot_level <- shot_level %>% \n#   mutate(log_yards_out_before_shot = log(yards_out_before_shot+1))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nfolds <- group_vfold_cv(data = shot_level,\n                        group = round)\n\njust_log_yards_recipe <- recipe(formula = strokes_remaining_before_shot ~ \n                              log_yards_out_before_shot, \n                      data = shot_level)\n\nlm_mod <- linear_reg(mode = \"regression\", \n                     engine = \"lm\")\n\nlm_workflow <- workflow() %>%\n  add_recipe(just_log_yards_recipe) %>% \n  add_model(lm_mod) \n\nlm_rs <- fit_resamples(object = lm_workflow,\n                       resamples = folds)\n\nlm_rs %>% \n  collect_metrics() %>% \n  select(.metric,\n         mean) %>% \n  as.data.frame()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  .metric      mean\n1    rmse 0.5734776\n2     rsq 0.7789109\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# just_yards_recipe <- recipe(formula = strokes_remaining_before_shot ~ \n#                               yards_out_before_shot, \n#                             data = shot_level)\n# \n# xgb_mod <- boost_tree(mode = \"regression\", \n#                       engine = \"xgboost\")\n# \n# xgb_workflow <- workflow() %>%\n#   add_recipe(just_yards_recipe) %>% \n#   add_model(xgb_mod) \n# \n# xgb_rs <- fit_resamples(object = xgb_workflow,\n#                         resamples = folds)\n# \n# xgb_rs %>% \n#   collect_metrics() %>% \n#   select(.metric,\n#          mean) %>% \n#   as.data.frame()\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# shot_level %>% \n#   filter(player == 1810,\n#          round == 1,\n#          hole == 1) %>% \n#   select(shot,\n#          strokes_remaining_before_shot,\n#          yards_out_before_shot,\n#          x,\n#          y)\n# \n# shot_level <- shot_level %>% \n#   group_by(player,\n#            round,\n#            hole) %>% \n#   mutate(x_before_shot = lag(x, \n#                              n = 1,\n#                              order_by = shot),\n#          y_before_shot = lag(y,\n#                              n = 1,\n#                              order_by = shot)) %>% \n#   ungroup()\n# \n# folds <- group_vfold_cv(data = shot_level,\n#                         group = round)\n# \n# with_coords_recipe <- recipe(formula = strokes_remaining_before_shot ~ \n#                                yards_out_before_shot +\n#                                x_before_shot +\n#                                y_before_shot +\n#                                hole, \n#                              data = shot_level)\n# \n# xgb_workflow <- workflow() %>%\n#   add_recipe(with_coords_recipe) %>% \n#   add_model(xgb_mod) \n# \n# xgb_rs <- fit_resamples(object = xgb_workflow,\n#                         resamples = folds)\n# \n# xgb_rs %>% \n#   collect_metrics() %>% \n#   select(.metric,\n#          mean) %>% \n#   as.data.frame()\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# round_1_hole_1 <- shot_level %>% \n#   filter(!is.na(x)) %>% \n#   filter(round == 1,\n#          hole == 1) %>% \n#   mutate(strokes_remaining = factor(strokes_remaining_after_shot,\n#                                     ordered = T)) \n# \n# round_1_hole_1 %>% \n#   select(x,\n#          y,\n#          strokes_remaining) %>% \n#   ggplot(mapping = aes(x = x,\n#                        y = y,\n#                        color = strokes_remaining)) +\n#   geom_point(size = 3) +\n#   coord_equal() +\n#   labs(title = \"1st Hole\") +\n#   theme(axis.text = element_blank(),\n#         axis.ticks = element_blank(),\n#         axis.title = element_blank(),\n#         panel.grid = element_blank())\n# \n# round_1_hole_1 %>% \n#   filter(strokes_remaining == 4) %>% \n#   select(player,\n#          player_first_name,\n#          player_last_name,\n#          shot)\n```\n:::\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}